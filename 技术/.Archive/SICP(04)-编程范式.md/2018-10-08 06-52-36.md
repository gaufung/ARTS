---
title: SICP(04)-编程范式
status: public
date: 2018-10-07
---

# 1 命令式编程
## 1.1 局部状态值
当设计一个银行账户系统的时候，很自然的用一个变量`balance`保存账户余额，每次取款`withdraw`和存款`deposit`都更新账户余额，初步系统设计如下：
```scheme
(define  (make-account balance)
    (define (withdraw amount)
        (if (>= balance amount)
                (begin (set! balance (- balance amount))
                    balance)
                    "Insufficient funds"))
    (define (depoist amount)
        (set! balance (+ balance amount))
        balance)
   (define (dispath m )
        (cond ((eq? m 'withdraw) withdraw)
                  ((eq? m 'deposit) deposit)
                  (else (error ("Unknown request -- MAKE-ACCOUNT" m))))
dispatch)
```
在这里`set!`语句就是赋值更新语句, 而`balance`则是内部的账户的状态变量，通过更新状态变量来保证账户系统的功能。
虽然使用局部状态很好的描述问题，但是该计算模型也存在弊端。比如`(define W1 (make-account 100)`创建了账户`W1`，对账户进行两次操作`((W1 'withdraw) 20)`，账户余额分别为`80`和`60`，相同的输入没有生成相同的输出，这样对于`函数`的概念就需要重新审视；而且如果重新定义一个账户`(define W2 (make-account 100))`，那么`W1`和`W2`是“等价”的吗，也就是说可以替换掉吗？
上述的编程模型属于命令式编程(imperative programming)，通过赋值的方式修改变量通常使得我们需要考虑赋值的顺序，这一点是非常重要的。
## 1.2 并行缺陷
使用更新设值的方式还存在一个巨大的问题，也就是在并行化设计系统的时候会出现意想不到的问题。语句`(set! balance (- balance amount))`其实包含了三个步骤，
- 取出`balance`变量
- `balance`减去`amount`
# 2 流(Stream)编程