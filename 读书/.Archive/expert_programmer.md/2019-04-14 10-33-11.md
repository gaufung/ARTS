---
title: 程序是如何运行起来的？
status: draft
date:  2019-04-09
---
# 1 背景
对于最简单的应用程序 `Hello World`, C 语言是这么实现的
```c
#include<stdio.h>
int main()
{
    printf("Hello World\n");
    return 0;
}
```
通过 `GCC` 或者 `MSVC` 编译后，就可以得到可执行文件，在操作系统执行该文件后，就会输出 `Hello World`。那么问题来了，这个应用程序是如何从编写的代码转换为计算机的输出？下面是中间包含的所有可能的问题：
1. 编译器做了哪些工作？
2. 可执行文件中包含了那些东西？是怎么组织的？
3. 不同的编译器在不同的平台下生成的文件是一样的吗？是如何同操作系统进行交互的？
4. 程序的入口在哪？计算机是如何一步步执行代码的？
5. 程序在执行的过程中如何使用 `CPU` 和内存的？
## 1.1 编译
使用 `gcc hello.c` 或者 `Visual Studio` 中的 `build` 按钮，就可以完成整个编译工作，但是**魔鬼隐藏在细节中**， 这个过程差不多包含了 4 个主要步骤：
1. 预编译
2. 编译
3. 汇编
4. 链接

### 1.1.1 预编译
预编译主要处理源代码中 `#` 开始预编译指令
- 展开所有的 `#define` 的宏定义；
- 根据编译条件，处理所有的的 `#if`, `#ifdef`, `#elif`, `#else` 等条件编译；
- 处理 `#include` 包含的指令，展开所有引用的文件；
- ...

### 1.1.2 编译
这个过程是构建应用程序核心过程，也是目前编译器相关研究关注的内容，它将源代码转为汇编代码，主要包含的流程有：
- 词法分析：源码转换为一系列预先定义好的 `Token`
- 语法分析：
## 1.2 运行

# 2 目标文件

## 2.1 段表

## 2.2 符号表

# 3 静态链接

## 3.1 地址分配

## 3.2 重定位