---
date: 2019-06-09
status: public
tags: APUE
title: APUE(01)
---

# 1 前言
[UNIX环境高级编程](https://book.douban.com/subject/25900403/)是一本久负盛名的书籍，本博客系列将会重点学习本书并附上学习笔记。为了尝试书中的代码，在 `MacOS` 操作系统如下操作：
- [下载页面](http://www.apuebook.com/code3e.html)
- 解压 `src.3e.tar.gz`
- `cp ./include/apue.h /Library/Developer/CommandLineTools/usr/include`
- `cp ./lib/error.c /Library/Developer/CommandLineTools/usr/include`
- 修改 `apue.h` 文件，在 `#endif` 之前插入 `#include "error.c"`

# 2 基础知识
## 2.1 体系结构
![](./_image/2019-06-09-14-00-19.jpg?r=50)
内核处于环境的核心，管理整个计算机的硬件资源；内核的接口称为系统调用，公用函数库构建在系统调用之上，应用程序既可以使用系统调用，也可以使用公用函数库。
## 2.2 登录
`cat /etc/passwd` 中查看用户登录
```
root:*:0:0:System Administrator:/var/root:/bin/sh
```
登录口令由 7 个冒号隔开的字段组成，依次为
- 用户名
- 加密口令
- 用户 ID
- 用户组 ID
- 注释
- 起始目录
- shell 程序

## 2.3 工作目录
每一个进程都有一个工作目录（working directory)，有时称为当前工作目录（ current working directory)。

## 2.4 输入和输出
*文件描述符* 是一个非负整数，内核用以标识一个特定进程正在访问的文件。
每一个 `shell` 都会打开三个文件描述符，即 *标准输入*， *标准输出*和*标准错误*。如果不指定，这三个都指向终端。

## 2.5 进程
- 程序（`program`) 存储在磁盘上可执行的文件，内核使用 `exec` 函数执行；
- 进程（`process`) 程序执行的实体称为进程；
- 进程控制三个主要函数 `fork`，`exec` 和 `waitpid`
    - `fork` 对于父进程返回子进程的 `ID`，对子进程返回 `0`;
    - `waitpid` 父进程等待子进程结束；

## 2.6 出错处理
每个线程都有属于自己的局部 `errno`，以避免一个线程干扰另一个线程，注意两条规则：
- 如果没有出错，其值不会被例程清除，只有在返回值出错才会验证；
- 任何函数都不会将 `errno` 设置为 `0`。

## 2.7 用户标识
- 用户 `ID` 在登录口令中给出，它想系统标识各个不同的用户；其中用户 ID 为 `0` 的用户为根用户(`root`) 或者超级用户 (`superuser`)
- 组 `ID` 也在登录口令中给出。

用户 `ID` 和 组 `ID` 是 `4` 个字节组成，每个使用双字节整型数组保存。

## 2.8 信号
信号用于通知进程发生了某种情况。通常有三种方式处理
1. 忽略信号；
2. 按照系统默认方式处理；
3. 提供了一个函数，信号发生的时候调用该函数。

## 2.9 时间值
*日历时间* 为自协调世界时（`Coordinated Universal Time, UTC`) 1970 年 1 月 1 日 00:00:00 这个时间以来经历的秒数累计值；
*进程时间* 用以度量使用的中央处理器资源，度量进程执行时间包含如下
- 时钟时间：程序运行总时间，与系统中同时运行的进程数有关；
- 用户时间：执行用户指令的时间值；
- 系统 CPU 时间：执行内核程序的时间值。
