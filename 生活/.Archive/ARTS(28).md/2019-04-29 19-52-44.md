---
date: 2019-04-29
status: public
tags: ARTS
title: ARTS(28)
---

# 1 Algorithm
>设计一个实时数据流接收器，要求在任意时刻输出所有数据的中位数。

初步设计在内部维护一个有序队列，每接受一个数据，插入到这个有序队列中，时间复杂度为 $O(n^2)$。既然需要输出数据流的中位数，那么只需要维护好这个中位数即可，至于其他数据可以降低排序的顺序要求，所以我们可以借助堆 (`heap`) 这个数据结构。
![](./_image/2019-04-29-19-26-18.jpg)
将整个数据流划分到这个两个堆中，数据流的前半部分将构建最大堆，而后半分布构建最小堆。为了保证快速获取数据的中位数，保证这个两个堆的数据量相差不超过 1， 那么中位数必定最大堆的顶元素和最小堆顶元素中产生（或者取平均数），所以在接受数据流的时候，往最大堆和最小堆中依次插入数据，在插入数据后，比较最大堆和最小堆的顶元素，如何最大堆的的顶元素比最小堆的顶元素大，则交换这两个顶元素，保证局部的偏序性。
上图为堆的逻辑视图，堆完全可以使用数组保存，按照堆的层次存放到数组中，存在下面的两个性质：
- $i$ 节点的父节点为$\lfloor \frac{n-1}{2} \rfloor $
- $i$ 节点的孩子节点为 $2 i + 1$ 和 $2i + 2$

初始化一个堆，从最后位置依次比较它和其父节点的大小，如果不满足顺序关系，交换数据，如此迭代直到第一个元素，时间复杂度为 $O(n)$。
将一个数据插入到堆中，首先将它插入到数组的最后，比较其和父节点顺序关系，如果不满足则交换数据，然后继续往上比较，类似冒泡的形式，时间复杂度为 $O(log(n))$。
将一个顶层元素从堆中删除，首先将其
# 2 Review

# 3 Tips

# 4 Share
